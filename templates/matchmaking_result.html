<!DOCTYPE html>
<html>
<head>
    <title>Matchmaking Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 30px;
        }

        .container {
            max-width: 1000px;
            margin: auto;
        }

        .card {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        h2 { text-align: center; margin-bottom: 30px; }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .green { background-color: #e6f4ea; color: #2e7d32; }
        .orange { background-color: #fff4e5; color: #ef6c00; }
        .red { background-color: #fdecea; color: #c62828; }
        .gray { background-color: #eceff1; color: #546e7a; }

        .progress-container {
            background:#e0e0e0;
            border-radius:20px;
            height:22px;
            margin-top:10px;
        }

        .progress-bar {
            height:22px;
            border-radius:20px;
            text-align:center;
            color:white;
            font-size:12px;
            line-height:22px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th { background-color: #f1f3f6; }

        .btn {
            display:inline-block;
            padding:10px 18px;
            background:#5e35b1;
            color:white;
            border-radius:6px;
            text-decoration:none;
            font-weight:bold;
            margin-top:10px;
        }

        .footer-note {
            text-align:center;
            margin-top:30px;
            font-size:13px;
            color:#777;
        }
    </style>
</head>
<body>

<div class="container">

<h2>‚ù§Ô∏è Advanced Matchmaking Compatibility Report</h2>

{% set score = match.score if match and match.score is not none else None %}
{% set verdict = match.verdict if match and match.verdict else "Pending" %}
{% set guna_breakdown = match.guna_breakdown if match and match.guna_breakdown else {} %}
{% set dosha_flags = match.dosha_flags if match and match.dosha_flags else {} %}
{% set marriage_risk = match.marriage_risk if match and match.marriage_risk else None %}

<!-- SUMMARY -->
<div class="card">

    <strong>Total Score:</strong>
    {% if score is not none %}
        {% if score >= 28 %}
            <span class="badge green">{{ score }} / 36</span>
        {% elif score >= 18 %}
            <span class="badge orange">{{ score }} / 36</span>
        {% else %}
            <span class="badge red">{{ score }} / 36</span>
        {% endif %}
    {% else %}
        <span class="badge gray">N/A</span>
    {% endif %}

    {% if score is not none %}
        {% set percentage = (score / 36) * 100 %}
        <div class="progress-container">
            <div class="progress-bar
                {% if score >= 28 %}green
                {% elif score >= 18 %}orange
                {% else %}red
                {% endif %}
            " style="width: {{ percentage }}%;">
                {{ score }}/36
            </div>
        </div>
    {% endif %}

    <p style="margin-top:15px;">
        <strong>Verdict:</strong>
        <span class="badge {% if score and score >= 28 %}green{% elif score and score >= 18 %}orange{% else %}gray{% endif %}">
            {{ verdict }}
        </span>
    </p>

</div>

<!-- GUNA BREAKDOWN -->
<div class="card">
    <h3>üîç Detailed Ashta Koota Breakdown</h3>

    {% if guna_breakdown %}
        <table>
            <tr>
                <th>Koota</th>
                <th>Score</th>
                <th>Max</th>
            </tr>
            {% for koota, details in guna_breakdown.items() %}
            <tr>
                <td>{{ koota|capitalize }}</td>
                <td>{{ details.score if details.score is not none else 0 }}</td>
                <td>{{ details.max_score if details.max_score is not none else 0 }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p style="color:#777;">Breakdown data not available.</p>
    {% endif %}
</div>

<!-- DOSHA COMPATIBILITY -->
<div class="card">
    <h3>üßø Dosha Compatibility</h3>

    {% if dosha_flags %}
        {% for dosha, status in dosha_flags.items() %}
            <p>{{ dosha|capitalize }} :
                <span class="badge {% if status %}red{% else %}green{% endif %}">
                    {% if status %}Present{% else %}Not Present{% endif %}
                </span>
            </p>
        {% endfor %}
    {% else %}
        <p style="color:#777;">No major dosha conflict detected.</p>
    {% endif %}
</div>

<!-- MARRIAGE RISK INDEX -->
<div class="card">
    <h3>‚ö† Marriage Risk Index</h3>

    {% if marriage_risk %}
        <span class="badge 
            {% if marriage_risk == 'Low' %}green
            {% elif marriage_risk == 'Moderate' %}orange
            {% else %}red
            {% endif %}
        ">
            {{ marriage_risk }}
        </span>
    {% else %}
        <span class="badge gray">Not Calculated</span>
    {% endif %}
</div>

<!-- AI SUMMARY -->
<div class="card">
    <h3>ü§ñ AI Compatibility Insight</h3>

    {% if score is not none %}
        {% if score >= 28 %}
            <p>This alliance shows strong traditional compatibility. Emotional, spiritual and practical harmony indicators are positive.</p>
        {% elif score >= 18 %}
            <p>The match shows moderate compatibility. Some effort and understanding may be required for long-term balance.</p>
        {% else %}
            <p>This pairing may face compatibility challenges. Professional astrological guidance is advised before proceeding.</p>
        {% endif %}
    {% else %}
        <p>Compatibility insight unavailable.</p>
    {% endif %}
</div>

<!-- DOWNLOAD BUTTON -->
<div class="card" style="text-align:center;">
    <a href="{{ url_for('download_pdf') }}" class="btn">üìÑ Download Full Matchmaking Report</a>
</div>

<div style="text-align:center;">
    <a href="{{ url_for('astrology') }}">‚¨Ö Back to Astrology</a>
</div>

<div class="footer-note">
    Powered by Ashta Koota System + Lal Kitab Intelligence Engine
</div>

</div>
</body>
</html>